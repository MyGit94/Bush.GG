<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>

    <!-- css -->
    <th:block th:replace="common/fragments/config :: configFragment" />
    <link rel="stylesheet" href="/css/register.css">
</head>

<body>

    <div class="container">

        <div class="card o-hidden border-0 shadow-lg my-5">
            <div class="card-body p-0">
                <!-- Nested Row within Card Body -->
                <div class="row">
                    <div class="col-lg-5 d-none d-lg-block bg-register-image">
                        <img src="/img/member/register.jpg" alt="">
                    </div>
                    <div class="col-lg-7">
                        <div class="p-5">
                            <div class="text-center">
                                <h1 class="h4 text-gray-900 mb-4">회원가입</h1>
                            </div>
                            <!-- 개인정보 입력 전체영역 -->
                            
						    <!-- 아이디&닉네임 끝 -->
                           <form class="user" method="post" action="/member/register" th:action="@{/member/register}" th:object="${memberDTO}">
                            
                               <!-- 아이디 -->
                               <div class="form-group row">
							      <div class="col-sm-6 mb-3 mb-sm-0">
							        <input type="text" class="form-control form-control-user" id="loginId"
							            th:field="*{loginId}" th:errorclass="text-danger" placeholder="아이디">
							        <div class="errors">
							        	<div class=errorBox>
							            	<p th:class="error" th:errors="*{loginId}">입력 오류메시지</p>
							            </div>
							            <!-- 아이디 중복 체크 결과 표시 -->
							            <!-- loginIdError가 있을 때만 렌더링 -->
         								<div class=errorBox>
							           		<p id="loginIdError" th:class="error"></p>
 										</div>	
							        </div>
							    </div>
                                
                                
                                <!-- 닉네임 -->
                                <div class="col-sm-6">
                                    <input type="text" class="form-control form-control-user"
                                    	th:field="*{nickName}" placeholder="닉네임">
                                    <div class="errors">
                                   		<div class=errorBox>
                                    		<p class="error" th:errors="*{nickName}">입력 오류메시지</p>
                                    	</div>
   										<!-- 닉네임 중복 체크 결과 표시 -->
							            <!-- nickNameError가 있을 때만 렌더링 -->
         								<div class=errorBox>
							           		<p id="nickNameError" th:class="error"></p>
 										</div>	
                                	</div>
                                </div>
                            </div>
                             <!-- 아이디&닉네임 끝 -->

                                <!-- 이메일 -->
                                <div class="form-group">
                                    <input type="email" class="form-control form-control-user"
                                    	th:field="*{email}" placeholder="이메일">
                                    <div class="errors">
                                   		<div class=errorBox>
                                    		<p class="error" th:errors="*{email}">입력 오류메시지</p>
                                    		</div>
   										<!-- 이메일 중복 체크 결과 표시 -->
							            <!-- emailError가 있을 때만 렌더링 -->
         								<div class=errorBox>
							           		<p id="emailError" th:class="error"></p>
 										</div>	
                                	</div>
                                </div>
                                <!-- 이메일 끝 -->

                                <!-- 비밀번호 -->
                                <div class="form-group row">
      
									<!-- 비밀번호 -->
									<div class="col-sm-6 mb-3 mb-sm-0">
									    <input type="password" class="form-control form-control-user"
									        th:field="*{passwd}" placeholder="비밀번호">
									    <div class="errors">
									        <div class=errorBox>
									            <p class="error" th:errors="*{passwd}">입력 오류메시지</p>
									        </div>
									    </div>
									</div>
									
									<!-- 비밀번호 확인 -->
									<div class="col-sm-6">
									    <input type="password" class="form-control form-control-user"
									        th:field="*{checkpasswd}" placeholder="비밀번호 확인">
									    <div class="errors">
									        <div class=errorBox>
									            <p class="error" th:errors="*{checkpasswd}">입력 오류메시지</p>
									        </div>
									        <div class=errorBox>
									            <!-- 비밀번호 확인 오류 메시지 표시 -->
            									<p th:if="${checkPasswordError}" th:class="error" th:text="${checkPasswordError}">비밀번호 확인 오류</p>
									        </div>
									    </div>
									</div>
                                </div>
                                <!-- 비밀번호 끝 -->

                                <!-- 회원가입 버튼 -->
                                <input type="submit" value="회원가입" th:value="#{member.button.register}" class="btn reigserBtn">
                                 <!-- 회원 가입 중복 경고 메시지 -->
								<div class="errors">
									<div class="errorBox">
	          						 	<p th:if="${duplicateWarning}" th:class="error" th:text="${duplicateWarning}">회원 가입 중복 경고</p>
									</div>
								</div>
                                <!-- 구분선 -->
                                <hr>

                                <!-- 구글 회원가입 버튼 -->
                                <a href="index.html" class="btn googleBtn">
                                    <i class="fab fa-google fa-fw"></i> Google로 회원가입
                                </a>

                            </form>
                            <!-- 개인정보 입력 전체영역 끝 -->
                            <!-- 구분선 -->
                            <hr>

                            <!-- 로그인하기 -->
                            <div class="text-center">
                                <a class="login_bushgg" th:href="@{/member/login}">이미 계정이 있나요? 로그인!</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
       <!--   자바 스크립트 -->
    <th:block th:replace="common/fragments/script :: scriptFragment"/>
    
<script>
$(document).ready(function() {
    $("#loginId").keyup(function() {
        var loginId = $(this).val();
        var regex = /^[a-z0-9]{6,12}$/; // 영어 소문자와 숫자로 이루어진 6~12자 사이

        // 최소 6자 이상인 경우에만 AJAX 요청을 보냅니다.
        if (loginId.length >= 2) {
            if (!regex.test(loginId)) {
                // 아이디가 허용된 문자 이외의 문자를 포함하고 있을 때 메시지 출력
                $("#loginIdError").text("영어 소문자와 숫자로 이루어진 6~12자 사이여야 합니다.");
            } else {
                // AJAX를 사용하여 서버에 아이디 중복 체크 요청
                $.ajax({
                    url: '/member/api/check-duplicate-loginid/' + loginId,
                    type: 'GET',
                    success: function(data) {
                        if (data.loginIdCheck) {
                            // 아이디 중복일 경우 메시지 출력
                            $("#loginIdError").text("이미 사용 중인 아이디입니다.");
                        } else {
                            // 아이디 중복이 아닐 경우 메시지 출력
                            $("#loginIdError").text("사용 가능한 아이디입니다.");
                        }
                    },
                    error: function() {
                        alert("치명적 오류 발생");
                    }
                });
            }
        } else {
            // 아이디가 2자 미만일 경우 메시지를 지웁니다.
            $("#loginIdError").text("");
        }
    });
});


$("#nickName").keyup(function() {
    var nickName = $(this).val();
    var regex = /^([가-힣]{2,8}|[a-zA-Z0-9가-힣]{4,10})$/; // 한글 2~8글자 또는 한글, 영어 소문자, 대문자, 숫자 조합 4~12글자 조건에 맞는 정규 표현식
    // 최소 2글자 이상인 경우에만 AJAX 요청을 보냅니다.
    if (nickName.length >= 2) {
        if (!regex.test(nickName)) {
            // 닉네임이 조건에 맞지 않을 때 메시지 출력
            $("#nickNameError").text("닉네임은 한글 2~8글자, 영어 소문자 4~12글자,대문자 2~8글자 이하로만 입력하세요.");
        } else {
            // AJAX를 사용하여 서버에 닉네임 중복 체크 요청
            $.ajax({
                url: '/member/api/check-duplicate-nickname/' + nickName, // 닉네임 중복 체크 API 주소 (변경 필요)
                type: 'GET',
                success: function(data) {
                    if (data.nickNameCheck) {
                        // 닉네임 중복일 경우 메시지 출력
                        $("#nickNameError").text("이미 사용 중인 닉네임입니다.");
                    } else {
                        // 닉네임 중복이 아닐 경우 메시지 출력
                        $("#nickNameError").text("사용 가능한 닉네임입니다.");
                    }
                },
                error: function() {
                    alert("치명적 오류 발생");
                }
            });
        }
    } else {
        // 닉네임이 2글자 미만일 경우 메시지를 지웁니다.
        $("#nickNameError").text("");
    }
});

//이메일 주소 중복 체크 (이메일 입력란의 id를 사용)
$("#email").keyup(function() {
    var email = $(this).val();
    
    // '@' 문자로 이메일 주소를 분리
    var parts = email.split('@');
    
    // 사용자 이름과 도메인 부분 가져오기
    var loginId = parts[0]; // 사용자 이름을 loginId로 변경
    var domain = parts[1];
    
    // 사용자 이름(loginId)과 도메인이 각각 최소 6글자 이상이어야 함
    if (loginId.length >= 6 && domain.length >= 6) {
        // AJAX 요청을 통해 이메일 중복 체크
        $.ajax({
            url: '/member/api/check-duplicate-email/' + email, // 이메일 중복 체크 API 주소 (변경 필요)
            type: 'GET',
            success: function(data) {
                if (data.EmailCheck) { // 수정: 변수 이름을 EmailCheck로 변경
                    // 이메일 중복일 경우 메시지 출력
                    $("#emailError").text("이미 사용 중인 이메일 주소입니다.");
                } else {
                    // 이메일 중복이 아닐 경우 메시지 출력
                    $("#emailError").text("사용 가능한 이메일 주소입니다.");
                }
            },
            error: function() {
                alert("치명적 오류 발생");
            }
        });
    } else {
        // 이메일이 최소 글자 수를 충족하지 못할 경우 메시지를 지웁니다.
        $("#emailError").text("");
    }
});

</script>
    
</body>


</html>